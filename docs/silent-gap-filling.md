# 無音部分の空白字幕補完機能

## 🎯 概要

WhisperAPIが認識しない無音部分に空白の字幕行を追加することで、動画の完全性を保ちながら正確な時間管理を実現します。

## 🔧 実装内容

### 1. 動画の実際の長さを取得
```javascript
async function getVideoDuration(videoPath) {
  const { stdout } = await execAsync(`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "${videoPath}"`);
  return parseFloat(stdout.trim());
}
```

### 2. 無音部分の検出と補完
- **開始前の無音**: 最初のセグメントが0秒より後から始まる場合
- **セグメント間の空白**: 0.1秒以上の間隔がある場合
- **終了後の無音**: 最後のセグメント後に残り時間がある場合

### 3. 空白字幕の追加
```csv
start,end,subtitles
0:02.000,0:03.000,""
0:05.000,0:09.000,""
0:14.000,0:15.000,""
```

## 📊 効果

### Before（WhisperAPI結果のみ）
```csv
start,end,subtitles
0:00.000,0:02.000,"ニューワンダー"
0:03.000,0:05.000,"ワンダーと一緒に午後もご機嫌な一日を"
0:09.000,0:11.000,"よし、好きに始めるんだ"
0:12.000,0:13.000,"ロイヤルラテ新登場"
0:13.000,0:14.000,"朝日飲料"
```
**問題**: 15秒動画の最後1秒が欠落、セグメント間の空白が不明

### After（無音部分補完済み）
```csv
start,end,subtitles
0:00.000,0:02.000,"ニューワンダー"
0:02.000,0:03.000,""
0:03.000,0:05.000,"ワンダーと一緒に午後もご機嫌な一日を"
0:05.000,0:09.000,""
0:09.000,0:11.000,"よし、好きに始めるんだ"
0:11.000,0:12.000,""
0:12.000,0:13.000,"ロイヤルラテ新登場"
0:13.000,0:14.000,"朝日飲料"
0:14.000,0:15.000,""
```
**改善**: 完全な15秒をカバー、すべての時間帯に対応

## 💡 メリット

### 1. **完全なタイムライン**
- 動画の開始から終了まで完全にカバー
- 時間の抜けや重複がない

### 2. **制御しやすい**
- 無音部分も明示的に管理
- 手動編集時の参照点として活用

### 3. **動画処理の安定性**
- セグメント切り出し時の境界が明確
- 結合時のギャップを防止

### 4. **柔軟な編集**
- 空白部分に後から字幕を追加可能
- 無音部分の長さも視覚的に確認

## ⚙️ 設定可能パラメータ

### 空白検出の閾値
```javascript
if (gap > 0.1) { // 0.1秒以上の空白を検出
  // 必要に応じて調整可能: 0.05, 0.2, 0.5など
}
```

### 補完の範囲
```javascript
if (lastSegment.end < videoDuration - 0.1) {
  // 最後の0.1秒未満は無視
  // より厳密にしたい場合は0.01に変更
}
```

## 🎬 使用例

### 15秒のCM動画
- **0-2秒**: "ニューワンダー"
- **2-3秒**: 無音（画面のみ）
- **3-5秒**: "ワンダーと一緒に..."
- **5-9秒**: BGMのみ（無音扱い）
- **9-11秒**: "よし、好きに始める"
- **11-12秒**: 無音
- **12-14秒**: "ロイヤルラテ新登場 朝日飲料"
- **14-15秒**: ロゴ表示（無音）

すべての時間帯がCSVに含まれ、動画編集時に正確に処理されます。