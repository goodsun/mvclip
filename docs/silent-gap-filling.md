# ç„¡éŸ³éƒ¨åˆ†ã®ç©ºç™½å­—å¹•è£œå®Œæ©Ÿèƒ½

## ğŸ¯ æ¦‚è¦

WhisperAPIãŒèªè­˜ã—ãªã„ç„¡éŸ³éƒ¨åˆ†ã«ç©ºç™½ã®å­—å¹•è¡Œã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€å‹•ç”»ã®å®Œå…¨æ€§ã‚’ä¿ã¡ãªãŒã‚‰æ­£ç¢ºãªæ™‚é–“ç®¡ç†ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ğŸ”§ å®Ÿè£…å†…å®¹

### 1. å‹•ç”»ã®å®Ÿéš›ã®é•·ã•ã‚’å–å¾—
```javascript
async function getVideoDuration(videoPath) {
  const { stdout } = await execAsync(`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "${videoPath}"`);
  return parseFloat(stdout.trim());
}
```

### 2. ç„¡éŸ³éƒ¨åˆ†ã®æ¤œå‡ºã¨è£œå®Œ
- **é–‹å§‹å‰ã®ç„¡éŸ³**: æœ€åˆã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒ0ç§’ã‚ˆã‚Šå¾Œã‹ã‚‰å§‹ã¾ã‚‹å ´åˆ
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–“ã®ç©ºç™½**: 0.1ç§’ä»¥ä¸Šã®é–“éš”ãŒã‚ã‚‹å ´åˆ
- **çµ‚äº†å¾Œã®ç„¡éŸ³**: æœ€å¾Œã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¾Œã«æ®‹ã‚Šæ™‚é–“ãŒã‚ã‚‹å ´åˆ

### 3. ç©ºç™½å­—å¹•ã®è¿½åŠ 
```csv
start,end,subtitles
0:02.000,0:03.000,""
0:05.000,0:09.000,""
0:14.000,0:15.000,""
```

## ğŸ“Š åŠ¹æœ

### Beforeï¼ˆWhisperAPIçµæœã®ã¿ï¼‰
```csv
start,end,subtitles
0:00.000,0:02.000,"ãƒ‹ãƒ¥ãƒ¼ãƒ¯ãƒ³ãƒ€ãƒ¼"
0:03.000,0:05.000,"ãƒ¯ãƒ³ãƒ€ãƒ¼ã¨ä¸€ç·’ã«åˆå¾Œã‚‚ã”æ©Ÿå«Œãªä¸€æ—¥ã‚’"
0:09.000,0:11.000,"ã‚ˆã—ã€å¥½ãã«å§‹ã‚ã‚‹ã‚“ã "
0:12.000,0:13.000,"ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ©ãƒ†æ–°ç™»å ´"
0:13.000,0:14.000,"æœæ—¥é£²æ–™"
```
**å•é¡Œ**: 15ç§’å‹•ç”»ã®æœ€å¾Œ1ç§’ãŒæ¬ è½ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–“ã®ç©ºç™½ãŒä¸æ˜

### Afterï¼ˆç„¡éŸ³éƒ¨åˆ†è£œå®Œæ¸ˆã¿ï¼‰
```csv
start,end,subtitles
0:00.000,0:02.000,"ãƒ‹ãƒ¥ãƒ¼ãƒ¯ãƒ³ãƒ€ãƒ¼"
0:02.000,0:03.000,""
0:03.000,0:05.000,"ãƒ¯ãƒ³ãƒ€ãƒ¼ã¨ä¸€ç·’ã«åˆå¾Œã‚‚ã”æ©Ÿå«Œãªä¸€æ—¥ã‚’"
0:05.000,0:09.000,""
0:09.000,0:11.000,"ã‚ˆã—ã€å¥½ãã«å§‹ã‚ã‚‹ã‚“ã "
0:11.000,0:12.000,""
0:12.000,0:13.000,"ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ©ãƒ†æ–°ç™»å ´"
0:13.000,0:14.000,"æœæ—¥é£²æ–™"
0:14.000,0:15.000,""
```
**æ”¹å–„**: å®Œå…¨ãª15ç§’ã‚’ã‚«ãƒãƒ¼ã€ã™ã¹ã¦ã®æ™‚é–“å¸¯ã«å¯¾å¿œ

## ğŸ’¡ ãƒ¡ãƒªãƒƒãƒˆ

### 1. **å®Œå…¨ãªã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**
- å‹•ç”»ã®é–‹å§‹ã‹ã‚‰çµ‚äº†ã¾ã§å®Œå…¨ã«ã‚«ãƒãƒ¼
- æ™‚é–“ã®æŠœã‘ã‚„é‡è¤‡ãŒãªã„

### 2. **åˆ¶å¾¡ã—ã‚„ã™ã„**
- ç„¡éŸ³éƒ¨åˆ†ã‚‚æ˜ç¤ºçš„ã«ç®¡ç†
- æ‰‹å‹•ç·¨é›†æ™‚ã®å‚ç…§ç‚¹ã¨ã—ã¦æ´»ç”¨

### 3. **å‹•ç”»å‡¦ç†ã®å®‰å®šæ€§**
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ‡ã‚Šå‡ºã—æ™‚ã®å¢ƒç•ŒãŒæ˜ç¢º
- çµåˆæ™‚ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’é˜²æ­¢

### 4. **æŸ”è»Ÿãªç·¨é›†**
- ç©ºç™½éƒ¨åˆ†ã«å¾Œã‹ã‚‰å­—å¹•ã‚’è¿½åŠ å¯èƒ½
- ç„¡éŸ³éƒ¨åˆ†ã®é•·ã•ã‚‚è¦–è¦šçš„ã«ç¢ºèª

## âš™ï¸ è¨­å®šå¯èƒ½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### ç©ºç™½æ¤œå‡ºã®é–¾å€¤
```javascript
if (gap > 0.1) { // 0.1ç§’ä»¥ä¸Šã®ç©ºç™½ã‚’æ¤œå‡º
  // å¿…è¦ã«å¿œã˜ã¦èª¿æ•´å¯èƒ½: 0.05, 0.2, 0.5ãªã©
}
```

### è£œå®Œã®ç¯„å›²
```javascript
if (lastSegment.end < videoDuration - 0.1) {
  // æœ€å¾Œã®0.1ç§’æœªæº€ã¯ç„¡è¦–
  // ã‚ˆã‚Šå³å¯†ã«ã—ãŸã„å ´åˆã¯0.01ã«å¤‰æ›´
}
```

## ğŸ¬ ä½¿ç”¨ä¾‹

### 15ç§’ã®CMå‹•ç”»
- **0-2ç§’**: "ãƒ‹ãƒ¥ãƒ¼ãƒ¯ãƒ³ãƒ€ãƒ¼"
- **2-3ç§’**: ç„¡éŸ³ï¼ˆç”»é¢ã®ã¿ï¼‰
- **3-5ç§’**: "ãƒ¯ãƒ³ãƒ€ãƒ¼ã¨ä¸€ç·’ã«..."
- **5-9ç§’**: BGMã®ã¿ï¼ˆç„¡éŸ³æ‰±ã„ï¼‰
- **9-11ç§’**: "ã‚ˆã—ã€å¥½ãã«å§‹ã‚ã‚‹"
- **11-12ç§’**: ç„¡éŸ³
- **12-14ç§’**: "ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ©ãƒ†æ–°ç™»å ´ æœæ—¥é£²æ–™"
- **14-15ç§’**: ãƒ­ã‚´è¡¨ç¤ºï¼ˆç„¡éŸ³ï¼‰

ã™ã¹ã¦ã®æ™‚é–“å¸¯ãŒCSVã«å«ã¾ã‚Œã€å‹•ç”»ç·¨é›†æ™‚ã«æ­£ç¢ºã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚