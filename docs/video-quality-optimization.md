# 動画品質の用途別最適化

## 🎯 概要

字幕解析用と動画編集用で異なる品質設定を適用し、用途に応じた最適化を実現しました。

## 🔧 実装内容

### 1. **用途別ダウンロード設定**

#### 字幕解析用（purpose: 'analysis'）
```javascript
{
  quality: 'highest',
  filter: 'audioandvideo'
}
```
- 音声品質を重視
- 適度な画質で効率的な処理

#### 動画編集用（purpose: 'editing'）
```javascript
{
  quality: 'highestvideo+bestaudio',
  format: 'best[height>=720]', // 最低720p以上
  filter: 'audioandvideo'
}
```
- **最高画質**: 1080p, 1440p, 4Kなど利用可能な最高解像度
- **最低保証**: 720p以上の品質を保証
- **高音質**: 最高品質の音声も同時取得

### 2. **フロントエンドでの用途指定**

#### 字幕解析モード
```javascript
const downloadOptions = { 
    url, 
    purpose: 'analysis'
};
```

#### 動画編集モード
```javascript
body: JSON.stringify({ 
    url, 
    purpose: 'editing'
})
```

## 📊 品質比較

### 字幕解析用
- **解像度**: 通常720p-1080p
- **ファイルサイズ**: 適度（高速ダウンロード）
- **用途**: 音声認識のみなので画質は適度で十分

### 動画編集用
- **解像度**: 最高利用可能（1080p, 1440p, 4K等）
- **ファイルサイズ**: 大（高品質）
- **用途**: 最終出力の画質を重視

## 🎬 効果

### Before
```
すべて同一品質: quality: 'highest'
・字幕解析: 無駄に高画質（処理重い）
・動画編集: 画質が不十分な場合あり
```

### After
```
字幕解析用: 効率重視の適度な品質
動画編集用: 最高画質（720p以上保証）
・字幕解析: 高速処理
・動画編集: プロ品質の出力
```

## 💡 具体的な改善

### 1. **ytdl-coreの設定**
```javascript
// 動画編集用の強化設定
if (options.purpose === 'editing') {
  ytdlOptions.format = 'best[height>=720]';
  console.log('🎬 動画編集用: 最高画質設定を適用');
}
```

### 2. **品質選択の優先順位**
- `highestvideo+bestaudio`: 最高画質動画＋最高音質を組み合わせ
- `best[height>=720]`: 720p未満は選択しない
- フォールバック: 利用不可の場合は標準設定

### 3. **ログでの確認**
```
📹 ダウンロード用途: 字幕解析用
📹 ダウンロード用途: 動画編集用
🎬 動画編集用: 最高画質設定を適用
```

## ⚡ パフォーマンス

### 字幕解析
- **ダウンロード時間**: 短縮
- **ストレージ使用量**: 削減
- **処理速度**: 向上

### 動画編集
- **出力品質**: 大幅向上
- **プロ仕様**: 商用レベルの品質
- **将来対応**: 4K動画にも対応

これにより、各用途に最適化された品質で効率的な処理が可能になりました。